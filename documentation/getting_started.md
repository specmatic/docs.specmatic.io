---
layout: default
title: Getting started (in 5 min)
parent: Documentation
nav_order: 1
---
Getting started
===============

### Setup

The quickest approach to getting started is through the command line.

{% include setup_command_line.md %}

---

### Example Application - PetStore

PetStore application has a backend API (Provider) and a front-end client application (Consumer).
Below is a sequence diagram.

    UI (Consumer)          API (Provider)
          | --- getPetById ---> |
          | <-- {Pet JSON} ---- |

---

### Authoring a contract
    
Let us try specifying the above interaction as a contract.

{% include authoring_contract_introduction.md %}

---

### Consumer Side - Contract As A Stub

Let us start with the Consumer in this example. We will be running a Stub / Mock Server based on the above contract file.

    UI (Consumer)         Qontract Stub <- service.qontract
          | --- getPetById ---> |
          | <-- {Pet JSON} ---- |

To spin up a stub server with the service.qontract we authored earlier, run below command.

    qontract stub --path="<base-dir>/petstore/qontract/service.qontract" --host="localhost" --port="8000" start

The command has defaults and necessary help to guide you through.

Once the stub server is running you can verify the API by accessing it through Postman, Chrome, Curl etc. to see the response.

    >curl http://localhost:8000/pets/123
    {"petid":180}

The response contains auto-generated values that adhere to the data type defined in the contract.

Example: In above output petid "180" is generated by qontract and will vary with every execution. If you would like to control the value that is being generated please refer to [suggestions](/documentation/suggestions.html).

We can now start consumer development against this stub without any dependency on the real API.

---

### Provider Side - Contract as a Test

Qontract runs Contract Tests on API to make sure it adheres to the contract.

    service.qontract -> Qontract Test        API (Provider)
                            | --- getPetById ---> |
                            | <-- {Pet JSON} ---- |

Below command runs service.qontract as a contract test against the provider.

    qontract test --path="<base-dir>/petstore/contract/service.qontract" --host="localhost" --port="8000" run
    
You should see below error message.

    Scenario: Should be able to get a pet by petId GET /pets/(id:number) FAILED
    Reason: Connection refused
    Tests run: 1, Failures: 1
    
This make sense because we have not written code for the Provider yet.
Also notice each scenario is considered as a test. Which is why is you see Test run: 1 and Failures: 1.

Let us spin up a API to get this test to pass. I am going to leverage Sinatra. However you could run any server.

```
# server.rb
require 'sinatra'

get '/' do
  'Welcome to Petstore!'
end
```

After I start the above server, I run the command again.

    Scenario: Should be able to get a pet by petId GET /pets/(petid:number) FAILED
    Reason: Response did not match
    	    Expected: 200 Actual: 404
    	Request: HttpRequest(method=GET, path=/pets/491, headers={Content-Type=text/plain}, body=, queryParams={}, formFields={})
    	Response: {"status":404,"status-text":"Not Found","headers":{"Content-Type":"text/html;charset=utf-8","X-Cascade":"pass","Content-Length":"471","X-Xss-Protection":"1; mode=block","X-Content-Type-Options":"nosniff","X-Frame-Options":"SAMEORIGIN","Server":"WEBrick/1.4.2 (Ruby/2.6.3/2019-04-16)","Date":"Sun, 29 Mar 2020 15:04:59 GMT","Connection":"Keep-Alive"}}

This time it is a different error and it rightly points out that the petstore API does not support /pets/:id endpoint. 
It also prints request and response to help us debug.

Let us add the /pets/:id endpoint to our API.

```
# server.rb
require 'sinatra'
require 'json'

get "/pets/:id" do
  content_type :json
  "{ petid: #{params['id']} }"
end
```

When we run the command this time we see success.

    Scenario: Should be able to get a pet by petId GET /pets/(petid:number) SUCCESSFUL
    Tests run: 1, Failures: 0

You may have noticed that we started with a contract and then leveraged it as a test to drive the API development. This is quite similar to BDD.

---

Got another 10 minutes? Try the [programmatic approach](/documentation/getting_started_programmatically.html)

